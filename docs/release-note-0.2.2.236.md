xyzzy 0.2.2.236 Release Note
============================

リリース日: 2012-03-29

はじめに
--------

2304。

亀井さんによる最後のバージョン (0.2.2.235) がリリースされてから、
有志による最初のバージョン (0.2.2.236) がリリースされるまでにかかった日数であり、
また 48^2 でもあります。

0.2.2.236 は 0.2.2.235 との互換性を重視したバージョンです。
今まで利用してきた拡張はそのまま動作することを期待してもよいでしょう。

0.2.2.236 では 21 件の機能追加と、17 件のバグ修正を行なっています。
これらの修正は 9 人の有志の手により行われました。


インストール
------------

インストーラはありませんので zip を展開するだけです。
インストールから初期設定までは以下を参照してください。

http://xyzzy.s53.xrea.com/wiki/index.php?QuickTour


アップデート
------------

以下の手順で 0.2.2.235 からアップデートしてください。

  1. 0.2.2.235 のバックアップ取得
  2. 0.2.2.236 を上書き
  3. $XYZZY/html を削除 ($XYZZY/docs/old に移動しています)
  4. xyzzy.wxp を削除
  5. xyzzy.exe 起動

lisp/ 配下や etc/ 配下をカスタマイズしている場合は
上書き後に再度カスタマイズをお願いします。


機能追加
--------

  * `mode-line-format` に `%/` を追加しました。(#26, mumurik)

    `%/` はカーソル位置がバッファ全体の何% の位置にあるかを表示します。

  * `mode-line-format` と `title-bar-format` に `%$` を追加しました。(#164, x022235)

    `%$` は xyzzy のプロセス ID を表示します。

  * Windows 7 のジャンプリストに少し対応しました。(#31, x022235)

    xyzyz に関連付けたファイルをダブルクリックして開いた場合などに
    ジャンプリストの最近使ったファイルに追加されます。

    xyzzy 内から `C-x f` などで開いた場合はジャンプリストには反映されませんが
    今後対応予定です。

  * ショートカット作成ダイアログを追加しました。(#154, x022235)

    ジャンプリストを利用するにはここで作成したショートカットを
    タスクバーに登録するようにしてください。

  * エアロスナップでウィンドウサイズを変更した場合もサイズを覚えるようになりました。(#153, x022235)

    0.2.2.235 ではエアロスナップでウィンドウサイズを変更すると、xyzzy 再起動後に
    スナップ前のサイズに戻ってしまっていました。

    「共通設定」→「さまざま」→「エアロスナップで変更した場合も保存」をチェックすることで
    スナップ後の位置を復元するようになります。

  * コマンドライン引数の -f オプションでパッケージ指定に対応しました。(#171, x022235)

    `xyzzy.exe -f pkg:pkg-function` という形式でパッケージ内の関数を実行できます。

  * `sql-mode` で以下の機能を追加しました。(#178, x022235)
    * SQL 92 の 「--」で始まる 1 行コメントに対応しました。
    * キーワードの補完に対応しました。(`M-Tab`)

  * キーワードファイル更新しました。(#46, x022235)
    * etc/C
      * C99 に対応しました。
    * etc/C++
      * C++ 11 に対応しました。
    * etc/C#
      * C# 5.0 に対応しました。
    * etc/CSS, etc/CSS3/*
      * CSS level 2, CSS level 3 に対応しました。
      * `css-mode` のデフォルトを CSS3 に更新しました。
        * `*css-level*` でデフォルト値を設定可能です。
        * `css2-mode`, `css3-mode` で切り替えることも可能です。
      * CSS3 のキーワードファイルはモジュールごとに分かれているので
        `*css3-keyword-files*` で読み込むモジュールをカスタマイズ可能です。
    * etc/HTML5
      * HTML5 に対応しました。
      * `<!DOCTYPE html>` の場合に自動的に HTML5 キーワードが有効になります。
      * `html+-mode` を使っている場合は `(setq *html+-use-html-kwd* t)` を設定してください。
    * etc/Perl
      * Perl 5.10 に対応しました。
    * etc/Java
      * Java 5.0 で追加されたキーワードに対応しました。
    * etc/Pascal
      * 色々追加しました。
    * etc/Sql, etc/Sql-NonStd/*
      * 色々追加しました。
      * DBMS 固有のキーワードを追加 (SQLServer, Oracle, MySQL, PostgreSQL) しました。
      * `(setq *sql-keyword-file* '("Sql" "Sql-NonStd/Oracle"))` など利用したい
        キーワードファイルをリストで設定してください。


バグ修正
--------

  * ウィンドウを分割していない状態で `scroll-other-window` などを実行した場合の
    エラーメッセージを改善しました。(#6, prtnog)

  * x64 マシンで c:/Windows/sytem32/drivers/etc/hosts が開けない問題を修正しました。(#4, x022235)

    また、C:/Windows/SysWoW64/drivers/etc ディレクトリを作成しておくことで
    C:/Windows/System32/drivers/ から etc/ の補完ができまるようになります。

  * xyzzy Lisp が長時間応答がなくなった場合でも `C-g` が効くようになりました。(#19, mumurik)

  * マルチディスプレイ利用時にツールチップやダイアログが常にプライマリモニタに
    表示される問題を修正しました。(#56, x022235)

  * マルチディスプレイ利用時にプライマリモニタ以外で xyzzy を終了すると
    次回起動後にウィンドウ位置が正しく復元されない問題を修正しました。(#56, x022235)

  * タグファイル作成時の初期ディレクトリを XTAGS ファイルから取得するようになりました。(#125, southly)

    例えば $XYZZY/ でタグファイルを作成しておくと、$XYZZY/ 配下のファイルを開いて
    タグファイルを作成ダイアログを開くと自動的に $XYZZY/ がデフォルトの
    ディレクトリとして表示されます。

  * カーソルが単語の末尾にあるときに辞書を引くとその単語を調べるようになりました。(#141, x022235)

    調べたい単語を入力して `C-c e` とすると入力した単語を辞書で引きます。


開発者向け機能追加
------------------

  * `lisp-mode` でマクロをインデントするときに、`&body` の位置から
    自動的にインデント位置を決定するようになりました。(#8, youz)

    `ed:lisp-indent-hook` が設定されていない場合のみ動作します。

  * `lisp-mode` でパッケージ名の補完ができるようになりました。(#144, x022235)

  * reference.xml を同梱しました。(#12, x022235)

    0.2.2.236 で追加した API は記述済みです。

  * lisp キーワードファイルを同梱しました。(#22, x022235)

    0.2.2.236 で追加した API は記述済みです。

  * `*features*` に `:widnows-8`  `:windows-7`  `:windows-vista` を追加しました。(#23, x022235)

    OS ごとに処理を変えたい場合は `(featurep :windows-7)` などと出来ます。
    また、`#+` と `#-` を使った読み込み時条件分岐 (Read Time Conditionals) でも利用できます。

  * `*features*` に `:x86`  `:x64`  `:ia64`  `:wow64` を追加しました。(#24, x022235)

    マシンアーキテクチャごとに処理を変えたい場合に利用できます。

  * `defpackage` に `:documentation` を追加しました。(#38, x022235)

    ドキュメントを取得するには `(documentation (find-package :foo) t)` とします。

  * SHA2 を計算する以下の関数を追加しました。(#39, x022235)
    * `si:sha-224` 
    * `si:sha-256` 
    * `si:sha-384` 
    * `si:sha-512` 

  * HMAC-SHA2 を計算する以下の関数を追加しました。(#40, x022235)
    * `si:hmac-sha-224`
    * `si:hmac-sha-256`
    * `si:hmac-sha-384`
    * `si:hmac-sha-512`

  * GUID を作成する以下の API を追加しました。(#162, x022235)
    * `si:uuid-create`

  * プロセス ID を取得する以下の API を追加しました。(#164, x022235)
    * `si:getpid`

  * ユニットテスト フレームワークを追加しました。(#5, bowbow99)

  * zlib 1.2.6 へ更新しました。(#155, x022235)


開発者向けバグ修正
------------------

  * `list-all-packages` がコピーを返すようになりました。(#7, youz)

  * `defstruct` の以下のバグを修正しました。(#36, x022235)
    * `print-function` が事前に定義されていないとエラーになる
    * 継承した `print-function` があるとバイトコンパイルできない
    * `print-function` を再定義しても反映されない
    * デフォルトのコンストラクタが必ず作られる
    * コンストラクタの引数の割り当てがおかしい
    * コンストラクタで引数を指定すると、スロット定義の初期値が無視される

  * `defpackage` の以下のバグを修正しました。 (#37, x022235)
    * `:shadowing-import-from` 2 つと `:shadow` を書くとエラー
    * パッケージが見つからない場合のエラーメッセージが不正

  * 他のパッケージから `import` したシンボルを `export` すると補完候補が重複する
    問題を修正しました。(#143, x022235)

  * ファイルとソケットに対する `si:*stream-column` が誤った値を返す問題を修正しました。(#166, x022235)

  * `format` 書式のバグを修正しました。(#2, southly)

    ```lisp
    (format nil "~0,1T")
    ""                         ; 0.2.2.235
    " "                        ; 0.2.2.236

    (format nil "~VT" nil)
    Vパラメータの型が不正です  ; 0.2.2.235
    " "                        ; 0.2.2.236

    (format nil "~,,VF" 3 pi)
    "3.141592653589793d0"      ; 0.2.2.235
    "3141.592653589793"        ; 0.2.2.236

    (format nil "~10g" 1.23456d+38)
    "^@^@^@^@^@^@    "                              ; 0.2.2.235
    "123456000000000000000000000000000000000.0    " ; 0.2.2.236

    (format nil "~E" 123.45)
    "123.45"                   ; 0.2.2.235
    "1.2345e+2"                ; 0.2.2.236

    (format nil "~@F" 123.45)
    "123.45"                   ; 0.2.2.235
    "+123.45"                  ; 0.2.2.236

    (format nil "~16,10,'*,'-,2:R" #x123abc)
    パラメータが多すぎます     ; 0.2.2.235
    "**12-3a-bc"               ; 0.2.2.236
    ```


Common Lisp との互換性向上
--------------------------

  * Common Lisp 互換の文字を追加しました。(#35, x022235)

    ```
    Common Lisp    xyzzy Lisp    char-code
    --------------------------------------
    #\Backspace    #\C-h                 8
    #\Tab          #\TAB                 9
    #\Newline      #\LFD                10
    #\Linefeed     #\LFD                10
    #\Page         #\C-l                12
    #\Return       #\RET                13
    #\Space        #\SPC                32
    #\Rubout       #\DEL               127
    ```

  * `machine-type`, `machine-version`, `machine-instance` を追加しました。(#41, x022235)
    * `machine-instance` は `ed:machine-name` と同じ値を返します
    * `machine-type`, `machine-version` などもあまり利用することはないと思いますが、
      CL のライブラリを移植しやすくするために追加しました。

  * `lisp-implementation-version`, `lisp-implementation-type` を追加しました。(#42, x022235)
    * `software-version`, `software-type` と同じ値を返します
    * CL のライブラリを移植しやすくするために追加しました。

  * repl 変数名を lisp パッケージから `export` しました。(#147, x022235)


注意事項
--------

  * 以下のフォーマット書式のバグは影響が大きいので修正されません。

    ```lisp
    (format nil "~10@A" "hoge")
    "hoge      "                   ; 0.2.2.235, 0.2.2.236
    "      hoge"                   ; 本来の仕様
    ```

  * NetInstaller で入手可能な以下のパッケージは 0.2.2.236 では
    本体に同梱しています。インストールすると古いファイルで上書きされるので
    インストールしないようにしてください。

    ```
    reference.txt                      2007.12.25     2007/12/25 01:28  | 2007.12.25     2007/12/25 01:28
    keyword file                       2007.12.25     2007/12/25 01:27  | 2007.12.25     2007/12/25 01:27
    reference.chm                      2007.12.25     2007/12/25 01:25  | 2007.12.25     2007/12/25 01:25
    reference.xml                      2007.12.25     2007/12/25 01:23  | 2007.12.25     2007/12/25 01:23
    ```


以上です。
